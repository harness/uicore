# name: Static Site

# on:
#   push:
#     branches:
#       - main

# jobs:
#   build:
#     name: Static Site Publish
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v2
#         with:
#           token: ${{ secrets.GIT_BOT_TOKEN }}
#           fetch-depth: 0

#       - name: Set Up Node
#         uses: actions/setup-node@v1
#         with:
#           node-version: '14'
#       - name: Set up GitHub Package Registry token
#         run: |
#           echo @wings-software:registry=https://npm.pkg.github.com > .npmrc
#           echo "//npm.pkg.github.com/:_authToken="$GIT_BOT_TOKEN >> .npmrc
#           echo always-auth=true >> .npmrc
#         env:
#           GIT_BOT_TOKEN: ${{ secrets.GIT_BOT_TOKEN }}
#       - name: Cache node_modules
#         uses: actions/cache@v1
#         with:
#           path: node_modules
#           key: ${{ runner.os }}-node-${{ hashFiles('yarn.lock') }}
#           restore-keys: ${{ runner.os }}-node-

#       - name: Install Packages
#         run: yarn

#       - name: Publish static site
#         run: |
#           yarn build-storybook -o ./public --quiet --loglevel error
#           cd public
#           git init -b main
#           GIT_USER=$(curl --silent -H "Authorization: token ${{ secrets.GIT_BOT_TOKEN }}" -X GET https://api.github.com/user)
#           GIT_USER_NAME=$(echo $GIT_USER | tr '\r\n' ' ' | jq -r .name)
#           GIT_USER_EMAIL=$(echo $GIT_USER | tr '\r\n' ' ' | jq -r .email)
#           git config user.name bot-harness
#           git config user.email bot@harness.io
#           git add .
#           git commit -m 'public static site'
#           git push --force --quiet "https://${{ secrets.GIT_BOT_TOKEN }}@github.com/${{ github.repository }}.git" main:static-site
